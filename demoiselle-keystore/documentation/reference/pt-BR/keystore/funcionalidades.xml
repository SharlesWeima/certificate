<?xml version='1.0' encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" []>
<chapter id="keystore-funcionalidades">

	<title id="funcionalidades">Funcionalidades</title>
	<para>
		As funcionalidades do componente estão acessíveis por meio da fábrica <emphasis>br.gov.frameworkdemoiselle.security.keystore.load.factory.KeyStoreLoaderFactory</emphasis>
		de objetos do tipo <emphasis>br.gov.frameworkdemoiselle.security.keystore.loader.KeyStoreLoader.</emphasis>
	</para>
	<para>
		O uso da fábrica é importante, mas não é obrigatório. A importância dela se deve à funcionalidade de descobrir qual a melhor implementação para o carregamento de KeyStore 
		baseando-se em configurações. Utilizando a fábrica não é necessário escrever códigos específicos para um determinado sistema operacional, pois a fábrica identifica qual o 
		sistema operacional e a versão da JVM para fabricar a melhor implementação.
	</para>

	<para>
		Exemplo de uso da fábrica de objetos KeyStoreLoader
	</para>

	<programlisting role="JAVA"><![CDATA[KeyStoreLoader keyStoreLoader = KeyStoreLoaderFactory.factoryKeyStoreLoader();]]></programlisting>

	<para>
		Exemplo de uso da fábrica de objetos KeyStoreLoader para KeyStore PKCS#12
	</para>

	<programlisting role="JAVA"><![CDATA[KeyStoreLoader keyStoreLoader = KeyStoreLoaderFactory.factoryKeyStoreLoader(new File("/usr/keystore.p12"));]]></programlisting>

	<section>
		<title>Carregamento de KeyStore PKCS#12</title>
		<para>
			Para carregar um KeyStore a partir de uma arquivo no formato PKCS#12 basta utilizar a classe 
			<emphasis>br.gov.frameworkdemoiselle.security.keystore.loader.implementation.FileSystemKeyStoreLoader.</emphasis>
		</para>

		<para>
			Abaixo temos exemplos de uso.
		</para>

		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = (new FileSystemKeyStoreLoader(new File("/usr/keystore.p12"))).getKeyStore("password");]]></programlisting>

		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = KeyStoreLoaderFactory.factoryKeyStoreLoader(new File("/usr/keystore.p12")).getKeyStore("password");]]></programlisting>

	</section>

	<section>
		<title>Carregamento de KeyStore PKCS#11 em ambiente Linux</title>

		<para>
			Para carregar um KeyStore PKCS#11 basta utilizar a classe <emphasis>br.gov.serpro.security.keystore.loader.implementation.DriverKeyStoreLoader.</emphasis>
		</para>

		<para>
			Para configuração de drivers favor acessar a área de Configuração do componente em <xref linkend="lista-drivers"/>.
		</para>

		<para>
			Abaixo temos exemplos de uso.
		</para>

		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = (new DriverKeyStoreLoader()).getKeyStore("PIN NUMBER");]]></programlisting>

		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = KeyStoreLoaderFactory.factoryKeyStoreLoader().getKeyStore("PIN NUMBER");]]></programlisting>

		<para>
			Caso se queira instanciar um KeyStore a partir de um driver específico que não esteja na lista de driver configurada, é possível informar o driver como parâmetro para a classe, veja o exemplo:
		</para>

		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = (new DriverKeyStoreLoader()).getKeyStore("PIN NUMBER", "Pronova", "/usr/lib/libepsng_p11.so");]]></programlisting>

		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = (new DriverKeyStoreLoader()).getKeyStore("PIN NUMBER", "/usr/lib/libepsng_p11.so");]]></programlisting>

		<important>
			<para>
				Este código também funciona em ambiente Windows, bastando especificar o driver correto a ser utilizado.
			</para>
		</important>

	</section>

	<section>
		<title>Carregamento de KeyStore PKCS#11 em ambiente Windows</title>
		<para>
			Para carregar um KeyStore utilizando a API nativa do Windows basta utilizar a classe <emphasis>br.gov.frameworkdemoiselle.security.keystore.loader.implementation.MSKeyStoreLoader.</emphasis>
		</para>

		<para>
			Abaixo temos exemplos de uso.
		</para>
		
		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = (new MSKeyStoreLoader()).getKeyStore(null);]]></programlisting>

		<programlisting role="JAVA"><![CDATA[KeyStore keyStore = KeyStoreLoaderFactory.factoryKeyStoreLoader().getKeyStore(null);]]></programlisting>

		<important>
			<para>
				Este recurso só funciona em JVM 1.6 ou superior. Caso deseje executar em um ambiente com o Java mais antigo, desabilite a camada MSCAPI e faça o acesso
				diretamente pelo driver. Para saber como proceder, consulte <xref linkend="disable_layer_mscapi" />.
			</para>
		</important>
	</section>
</chapter>
